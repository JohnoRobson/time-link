<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

	<h:body>
	<ui:composition template="resources/templates/template.xhtml">
	    <ui:define name="content">
	    	<div class="timesheetHead">
	    		<div class="timesheetSubOne">
	    			<h:panelGrid columns="2">
	    				<h:outputLabel value="Name:" />
	    				<h:outputText value="#{Session.currentEmployee.firstName} #{Session.currentEmployee.lastName}" />
	    				<h:outputLabel value="Title:" />
	    				<h:outputText value="placeholder" />
	   					<h:outputLabel value="Date:" />
	   					<h:outputText value="#{TimesheetController.selectedTimesheet.date}" />
	    			</h:panelGrid>
	    		</div>
	    		<div class="timesheetSubTwo">
	    			<h:panelGrid columns="2">
	    				<h:outputLabel value="UserId:" />
	    				<h:outputText value="#{Session.currentEmployee.employeeId}" />
	    				<h:outputLabel value="Department:" />
	    				<h:outputText value="placeholder" />
	   					<h:outputLabel value="Week No:" />
	   					<h:outputText value="PlaceHolder 5" />
	    			</h:panelGrid>
	    		</div>
	    	</div>

	        <h:form>
	        <p:panel id="tscontent">
	        <div class="tsCont">
	        	<p:selectOneMenu styleClass="tsDrop" value="#{TimesheetController.selectedTimesheetId}">
		            	<p:ajax event="itemSelect" update=":#{p:component('tscontent')}" />
		            	<f:selectItem itemLabel="Select Timesheet" itemValue="" noSelectionOption="true" />
		            	<f:selectItems value="#{TimesheetController.getTimesheets() != null ? TimesheetController.getTimesheets() : null}" 
		            				   var="ts" itemLabel="Year: #{1900 + ts.date.getYear()} Week Number: #{TimesheetController.getWeekNumber(ts)}" 
		            				   itemValue="#{ts.timesheetId}" />
        			</p:selectOneMenu>
	        <p:remoteCommand name="onCellEdit" update="tscontent" />
	        <p:dataTable id="table" var="row" value="#{TimesheetController.selectedTimesheet.rows}" 
	        			 editable="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" 
	        			 editMode="cell" rowIndexVar="index" render="#{TimesheetController.selectedTimesheet != null}">
	        	
	        	<p:column styleClass="tsHeader" rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}">
	    				<p:commandButton
		                	title="Delete"
		                	type="button"
		                	icon="ui-icon-trash"
		                	action="#{TimesheetController.deleteRow(row)}"
		                	ajax="false">
		        		</p:commandButton>
	    			</p:column>
	        	
	        	<p:column headerText="project" styleClass="tsHeader">
	                <p:selectOneMenu value="#{row.projectId}" style="width:100%">
		                <p:ajax event="itemSelect" oncomplete="onCellEdit()" />
		                <f:selectItem itemLabel="" itemValue="#{0}"/>
		                <f:selectItems value="#{TimesheetController.getAssignedProjects() != null ? TimesheetController.getAssignedProjects() : null}" var="pro" itemLabel="#{pro.projectName}" itemValue="#{pro.projectNumber}" />
	                </p:selectOneMenu>
				</p:column>
				
				<p:column headerText="work package" styleClass="tsHeader">
	                <p:selectOneMenu value="#{row.workPackageId}" style="width:100%">
		                <p:ajax event="itemSelect" oncomplete="onCellEdit()" />
		                <f:selectItem itemLabel="" itemValue="#{0}"/>
		                <f:selectItems value="#{TimesheetController.getAssignedWorkPackages(row.projectId)}" var="wp" itemLabel="#{wp.code}" itemValue="#{wp.workPackageId}" />
	                </p:selectOneMenu>
				</p:column>
				
				<p:column headerText="sat" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(0).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(0).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
                                <p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                    
                </p:column>
                
                <p:column headerText="sun" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(1).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(1).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="mon" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(2).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(2).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="tues" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(3).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(3).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="wed" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(4).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(4).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="thurs" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(5).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(5).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="fri" styleClass="tsHeader weekDays">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(6).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(6).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="notes" styleClass="tsHeader">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{row.note}" />
                        </f:facet>
                        <f:facet name="input">
                            <h:inputText value="#{row.note}">
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
            
	        </p:dataTable>
	        
	        <p:panel id="totals">
	        <div class="subtotals">
	        	<h:panelGrid columns="2">
	        		<h:outputLabel value="Total:" />
	        		<h:outputText value="#{TimesheetController.selectedTimesheet != null ? TimesheetController.selectedTimesheet.getTotalHours() : 0}" />
	        		<h:outputLabel value="Overtime:" />
	        		<h:outputText value="#{TimesheetController.selectedTimesheet != null ? (TimesheetController.selectedTimesheet.getTotalHours() > 40 ? TimesheetController.selectedTimesheet.getTotalHours() - 40 : 0) : 0}" />
	        		<h:outputLabel value="Flexhours:" />
	        		<h:outputText value="#{TimesheetController.selectedTimesheet != null ? TimesheetController.selectedTimesheet.getTotalHours() - 40 : 0}" />
	        	</h:panelGrid>
	        	<h:panelGrid styleClass="status" columns="2">
	        		<h:outputLabel value="Status:" />
	        		<h:outputText value="#{TimesheetController.selectedTimesheet.status}" />
	        	</h:panelGrid>
	        	
	        	
	        	<p:panel rendered="#{TimesheetController.selectedTimesheet.status.equals('REJECTED')}">
		    		<h:outputText value="#{TimesheetController.selectedTimesheet.rejectionReason}" />
		    	</p:panel>
	        </div>
		    </p:panel>
		        <div class="btnGrp">
		        	<h:panelGrid columns="2">
	        			<p:commandButton rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" 
	        							 action="#{TimesheetController.addRow()}" value="add row" ajax="false" />
	        			<p:commandButton value="add timesheet" onclick="PF('addts').show();" />
	        		</h:panelGrid>
		        	<h:panelGrid columns="2" styleClass="btnGrpTwo">
		        		<p:commandButton rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" 
	        							 action="#{TimesheetController.save()}" value="save" ajax="false" />
	        			<p:commandButton rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" 
	        			    			 action="#{TimesheetController.submit()}" value="Submit" ajax="false" />
		        	</h:panelGrid>
	        	</div>
        	</div>
	        </p:panel>
	    </h:form>
	    
	    <!-- Add Timesheet Modal -->
	    <p:dialog
	    	header="Create New Timesheet"
            widgetVar="addts"
            modal="true"
            height="200">
	    	<h:form>
	            <h:panelGrid columns="2">
	            	<h:outputText styleClass="modalText" value="Year: "/>
	            	<p:inputText styleClass="modalText" value="#{TimesheetController.year}" required="true" />
	            	<h:outputText styleClass="modalText" value="Week Number: "/>
	            	<p:inputText styleClass="modalText" value="#{TimesheetController.week}" required="true" />
	            </h:panelGrid>
	            
	            <p:commandButton value="Create Timesheet" styleClass="modalBtn" 
	            				 action="#{TimesheetController.addTimesheet()}" ajax="false" />
	        </h:form>
	    </p:dialog>
	    
	    </ui:define>
	</ui:composition>
	</h:body>
</html>