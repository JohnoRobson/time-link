<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

	<h:body>
	<ui:composition template="resources/templates/template.xhtml">
		<ui:define name="header">
		<div id="nav" style="height:15%">
	        <div id="navContent">
	            <h1>TimeLink</h1>
	            <ul id="navList">
	                <li><a href="home.xhtml">Home</a></li>
	                <li><a href="timesheet.xhtml">Timesheet</a></li>
	                <li><a href="projcreation.xhtml">Create Project</a></li>
	                <li><a href="assignemp.xhtml">Manage Project</a></li>
	                <h:panelGroup rendered="#{Session.approver}">
	                	<li><a href="report.xhtml">Report</a></li>
	                </h:panelGroup>
	                <h:panelGroup rendered="#{Session.projectManager || Session.projectManagerAssistant}">
	                	<li><a href="projectplanning.xhtml">Enter Project Planning Information</a></li>
	                </h:panelGroup>
	                <li><a href="humanresources.xhtml">Human Resources</a></li>
	                <li><h:form><h:commandLink value="Logout" action="#{Session.endSession}"/></h:form></li>
	            </ul>
	        </div>
	    </div>
	    </ui:define>
	    <ui:define name="content">
	    	
	        <div id="timesheetHeader">
	            <div id="left" class="headerPart">
	                <p>Name:</p><p><h:outputText value="#{Session.currentEmployee.firstName} #{Session.currentEmployee.lastName}" /></p>
	                <br />
	                <p>Title:</p><p>PLACEHOLDER: UI Specialist</p>
	                <br />
	                <p>Date:</p><p><h:outputText value="#{TimesheetController.selectedTimesheet.date}" /></p>
	            </div>
	            <div id="right" class="headerPart">
	                <p>UserID:</p><p><h:outputText value="#{Session.currentEmployee.employeeId}" /></p>
	                <br />
	                <p>Department:</p><p>PLACEHOLDER: BCIT_IS</p>
	                <br />
	                <p>Week:</p><p>PLACEHOLDER: 5</p>
	                <br />
	            </div>
	        </div>
	        <h:form>
	        <p:panel id="tscontent">
	        	<p:selectOneMenu value="#{TimesheetController.selectedTimesheetId}">
		            	<p:ajax event="itemSelect" update=":#{p:component('tscontent')}" />
		            	<f:selectItem itemLabel="Select Timesheet" itemValue="" noSelectionOption="true" />
		            	<f:selectItems value="#{TimesheetController.getTimesheets() != null ? TimesheetController.getTimesheets() : null}" 
		            				   var="ts" itemLabel="Year: #{1900 + ts.date.getYear()} Week Number: #{ts.getWeekNumber()}" 
		            				   itemValue="#{ts.timesheetId}" />
        			</p:selectOneMenu>
	        <p:remoteCommand name="onCellEdit" update="table, totals" />
	        <p:dataTable id="table" var="row" value="#{TimesheetController.selectedTimesheet.rows}" editable="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" editMode="cell" rowIndexVar="index"
	        	render="#{TimesheetController.selectedTimesheet != null}">
	        	
	        	<p:column >
	    				<p:commandButton
		                	value="Delete Row"
		                	type="submit"
		                	action="#{TimesheetController.deleteRow(row)}"
		                	ajax="false"
		                	rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}">
		        		</p:commandButton>
	    			</p:column>
	        	
	        	<p:column headerText="project">
					<p:cellEditor>
					    <f:facet name="output">
					        <h:outputText value="#{ProjectManager.find(row.projectId) != null ? ProjectManager.find(row.projectId).projectName : '-'}" id="projID" />
					    </f:facet>
					    <f:facet name="input">
	                        <p:selectOneMenu value="#{row.projectId}" style="width:100%">
	                            <p:ajax event="itemSelect" oncomplete="onCellEdit()" />
	                            <f:selectItem itemLabel="" itemValue="#{0}"/>
	                            <f:selectItem itemLabel="Sick Day" itemValue="#{TimesheetController.getSickWorkPackage().project.projectNumber}" />
                                <f:selectItems value="#{Session.currentEmployee.projects != null ? Session.currentEmployee.projects : null}" var="pro" itemLabel="#{pro.projectName}" itemValue="#{pro.projectNumber}" />
                            </p:selectOneMenu>
	                    </f:facet>
					</p:cellEditor>
				</p:column>
				
				<p:column headerText="work package">
					<p:cellEditor>
					    <f:facet name="output">
					        <h:outputText value="#{WorkPackageManager.find(row.workPackageId) != null ? WorkPackageManager.find(row.workPackageId).code: '-'}" id="wpID" />
					    </f:facet>
					    <f:facet name="input">
	                        <p:selectOneMenu value="#{row.workPackageId}" style="width:100%">
	                            <p:ajax event="itemSelect" oncomplete="onCellEdit()" />
	                            <f:selectItem itemLabel="" itemValue="#{0}"/>
	                            <f:selectItem itemLabel="Sick Day" itemValue="#{TimesheetController.getSickWorkPackage().workPackageId}" />
                                <f:selectItems value="#{ProjectManager.find(row.projectId) != null ? TimesheetController.getAssignedWorkPackages(row.projectId) : null}" var="wp" itemLabel="#{wp.code}" itemValue="#{wp.workPackageId}" />
                            </p:selectOneMenu>
	                    </f:facet>
					</p:cellEditor>
				</p:column>
				
				<p:column headerText="sat">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(0).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(0).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
                                <p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                    
                </p:column>
                
                <p:column headerText="sun">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(1).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(1).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="mon">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(2).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(2).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="tues">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(3).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(3).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="wed">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(4).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(4).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="thurs">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(5).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(5).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="fri">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(6).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(6).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />
								<p:ajax event="change" oncomplete="onCellEdit()" />
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="notes">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{row.note}" />
                        </f:facet>
                        <f:facet name="input">
                            <h:inputText value="#{row.note}">
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
            
	        </p:dataTable>
	        
	        <p:panel id="totals">
	        
	        	<h:outputText value="Total #{TimesheetController.selectedTimesheet != null ? TimesheetController.selectedTimesheet.getTotalHours() : 0}" />
	        	<br />
	        	<h:outputText value="OverTime #{TimesheetController.selectedTimesheet != null ? (TimesheetController.selectedTimesheet.getTotalHours() > 40 ? TimesheetController.selectedTimesheet.getTotalHours() - 40 : 0) : 0}" />
	        	<br />
	        	<h:outputText value="FlexHours #{TimesheetController.selectedTimesheet != null ? TimesheetController.selectedTimesheet.getTotalHours() - 40 : 0}" />
	        	<br />
	        	<p><h:outputText value="STATUS: #{TimesheetController.selectedTimesheet.status}" /></p>
	        	
	        	<p:panel rendered="#{TimesheetController.selectedTimesheet.status.equals('REJECTED')}">
		    		<h:outputText value="PLACEHOLDER REASON FOR THE TIMESHEET BEING DECLINED" />
		    	</p:panel>
	        
	        </p:panel>
	        
        	<p:commandButton rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" action="#{TimesheetController.save()}" value="save" ajax="false" />
        	<p:commandButton rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" action="#{TimesheetController.addRow()}" value="add row" ajax="false" />
        	<p:commandButton value="add timesheet" onclick="PF('addts').show();" />
        	<p:commandButton rendered="#{TimesheetController.selectedTimesheet.status eq 'NOTSUBMITTED' || TimesheetController.selectedTimesheet.status eq 'REJECTED'}" action="#{TimesheetController.submit()}" value="Submit" ajax="false" />
        	
	        </p:panel>
		    
	    </h:form>
	    
	    <!-- Add Timesheet Modal -->
	    <p:dialog
	    	header="Create New Timesheet"
            widgetVar="addts"
            modal="true"
            height="300">
	    	<h:form>
	            <p:panelGrid columns="2">
	            	<h:outputText value="Year: "/>
	            	<h:inputText value="#{TimesheetController.year}" required="true" />
	            	<h:outputText value="Week Number: "/>
	            	<h:inputText value="#{TimesheetController.week}" required="true" />
	            </p:panelGrid>
	            <br />
	            <h:commandButton value="Create Timesheet" action="#{TimesheetController.addTimesheet()}" ajax="false" />
	        </h:form>
	    </p:dialog>
	    
	    </ui:define>
	    
	    <ui:define name="footer">
	    	footing it up 
	    </ui:define>
	</ui:composition>
	</h:body>
</html>