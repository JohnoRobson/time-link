<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

	<h:body>
	<ui:composition template="resources/templates/template.xhtml">
	    <ui:define name="content">
	    <div class="tsaPgWrapper">
	    	<div class="title tsaTitle">
	    		<hr />
	    		<h1 class="loginTitle">Timesheet Review</h1>
	    	</div>
        <p:growl id="growl" showDetail="true" sticky="true" />  
	    	<div class="listWrapper">
	    		<p:panel styleClass="projPanel">
	    			<h:form id="approverForm" style="width: 100%">
		    		<p:dataTable id="approveTable" var="row" value="#{ApproverController.list}" 
		    					 selection="#{ApproverController.selectedTimesheets}" rowKey="#{row.timesheetId}"
		    					 styleClass="tsaTable" >
		    		   <p:ajax event="rowSelectCheckbox" update=":#{p:component('buttons')}" />
  					   <p:ajax event="rowUnselectCheckbox" update=":#{p:component('buttons')}" />
 					   <p:ajax event="rowSelect" update=":#{p:component('buttons')}" />
 					   <p:ajax event="rowUnselect" update=":#{p:component('buttons')}" />
		    		<p:column selectionMode="multiple" style="width:16px;text-align:center" />
			        <p:column headerText="Date" styleClass="tsHeader hoursWidth">
			            <!-- DATE COLUMN -->
			            <h:outputText value="#{row.date}"> 
			            	<f:convertDateTime pattern="dd/MM/yy" />
			            </h:outputText>
			            
			        </p:column>
			        <p:column headerText="Emp Id" styleClass="tsHeader hoursWidth">
			            <!-- EmployeeID COLUMN -->
			            <h:outputText value="#{row.employee.employeeId}" />
			        </p:column>
			        <p:column headerText="Hours" styleClass="tsHeader hoursWidth">
			            <!-- TotalHours COLUMN -->
			            <h:outputText value="#{row.totalHours}" />
			        </p:column>
			        <p:column headerText="OT" styleClass="tsHeader tsaWidth" >
			            <!-- Overtime COLUMN -->
			            <h:outputText value="#{row.overtime}" />
			        </p:column>
			        <p:column headerText="Flex" styleClass="tsHeader tsaWidth">
			            <!-- FlexTime COLUMN -->
			            <h:outputText value="#{row.flextime}" />
			        </p:column>
			         <p:column headerText="Status" styleClass="tsHeader hoursWidth">
			            <h:outputText value="#{row.status}" />
			        </p:column>
			        <p:column headerText="View" styleClass="tsHeader" style="text-align:center">
			        	<p:commandButton value="View" action="#{ApproverController.setViewingTimesheet(row)}" ajax="false"/>
			        </p:column>
				    </p:dataTable>
				    <p:remoteCommand name="onCellEdit" update="buttons" />
				    <p:panel id="buttons" styleClass="projPanel">
				    	<p:commandButton value="Approve" action="#{ApproverController.approve()}" ajax="false" />
				    	<p:commandButton value="Decline" rendered="#{ApproverController.selectedTimesheets.size() != 1}" update="growl" actionListener="#{ApproverController.declineValidate}" />
				    	<p:commandButton value="Decline" rendered="#{ApproverController.selectedTimesheets.size() == 1 and ApproverController.timesheetIsApproved()}" update="growl" actionListener="#{ApproverController.declineValidate}" />
				    	<p:commandButton value="Decline" rendered="#{ApproverController.selectedTimesheets.size() == 1 and !ApproverController.timesheetIsApproved()}" update="growl" onclick="PF('rejectmodal').show()" />
				    </p:panel>
				   </h:form>
	    		</p:panel>
	    	
	    		<p:panel styleClass="projPanel">
	    		<p:dataTable id="table" var="row" value="#{ApproverController.viewingTimesheet.rows}" 
	    					 editable="#{false}" editMode="cell" rowIndexVar="index"
	    					 styleClass="tsaTable">
	        	<p:column headerText="Project" styleClass="tsHeader hoursWidth">
					<p:cellEditor>
					    <f:facet name="output">
					        <h:outputText value="#{ProjectManager.find(row.projectId) != null ? ProjectManager.find(row.projectId).projectName : '-'}" id="projID" />
					    </f:facet>
					    <f:facet name="input">
	                        <p:selectOneMenu value="#{row.projectId}" style="width:100%">
	                            <f:selectItem itemLabel="" itemValue="#{0}"/>
                                <f:selectItems value="#{Session.currentEmployee.projects != null ? Session.currentEmployee.projects : null}" var="pro" itemLabel="#{pro.projectName}" itemValue="#{pro.projectNumber}" />
                            </p:selectOneMenu>
	                    </f:facet>
					</p:cellEditor>
				</p:column>
				
				<p:column headerText="WP" styleClass="tsHeader statusWidth">
					<p:cellEditor>
					    <f:facet name="output">
					        <h:outputText value="#{WorkPackageManager.find(row.workPackageId) != null ? WorkPackageManager.find(row.workPackageId).code: '-'}" id="wpID" />
					    </f:facet>
					    <f:facet name="input">
	                        <p:selectOneMenu value="#{row.workPackageId}" style="width:100%">
	                            <f:selectItem itemLabel="" itemValue="#{0}"/>
                                <f:selectItems value="#{ProjectManager.find(row.projectId) != null ? TimesheetController.getAssignedWorkPackages(row.projectId) : null}" var="wp" itemLabel="#{wp.code}" itemValue="#{wp.workPackageId}" />
                            </p:selectOneMenu>
	                    </f:facet>
					</p:cellEditor>
				</p:column>
				
				<p:column headerText="Sat" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(0).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(0).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                    
                    </p:column>
                <p:column headerText="Sun" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(1).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(1).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="Mon" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(2).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(2).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="Tues" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(3).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(3).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="Wed" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(4).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(4).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="Thur" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(5).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(5).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="Fri" styleClass="tsHeader">
                    <p:cellEditor>
                        
                        <f:facet name="output">
                            <h:outputText value="#{row.hours.get(6).hour}" />
                        </f:facet>
                        <f:facet name="input">
                            
                            <h:inputText value="#{row.hours.get(6).hour}">
                                <f:validateDoubleRange minimum="0.0" maximum="24.0" />

                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                
                <p:column headerText="Notes" styleClass="tsHeader">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{row.note}" />
                        </f:facet>
                        <f:facet name="input">
                            <h:inputText value="#{row.note}">
                            </h:inputText>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
	        </p:dataTable>
	    </p:panel>
	    </div>
	    	    <!-- Rejection modal -->
	    <p:dialog
	        header="Reason for rejecting timesheet"
	        widgetVar="rejectmodal"
	        modal="true"
	        height="300">
	        <h:form>
	            <p:panelGrid columns="2">
	            <h:outputText value="Rejection reason: "/>
	            <h:inputText value="#{ApproverController.getSingleTimesheet().rejectionReason}"/>
	            </p:panelGrid>
	            <br />
	            <p:commandButton value="Reject" action="#{ApproverController.declineSave()}" ajax="false" />
	        </h:form>
	    </p:dialog>
	    </div>
		</ui:define>
	</ui:composition>
	</h:body>
</html>